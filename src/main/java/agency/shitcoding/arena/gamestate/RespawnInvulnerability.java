package agency.shitcoding.arena.gamestate;

import agency.shitcoding.arena.GameplayConstants;
import org.bukkit.entity.Player;
import org.bukkit.potion.PotionEffectType;

import java.util.HashMap;
import java.util.Map;

public class RespawnInvulnerability {
    private final Map<Player, Long> respawnTimes = new HashMap<>();

    public void registerRespawn(Player player) {
        int effectDuration = (int)(GameplayConstants.RESPAWN_INVULNERABILITY_DURATION_MS / 1000) * 20;
        player.addPotionEffect(PotionEffectType.FIRE_RESISTANCE.createEffect(effectDuration, 1));

        respawnTimes.put(player, System.currentTimeMillis());
    }

    public void onShoot(Player player) {
        if (GameplayConstants.RESPAWN_INVULNERABILITY_DISABLE_ON_SHOOT) {
            player.removePotionEffect(PotionEffectType.FIRE_RESISTANCE);
            respawnTimes.remove(player);
        }
    }

    public boolean hasInvulnerability(Player player) {
        Long l = respawnTimes.get(player);
        long now = System.currentTimeMillis() + GameplayConstants.RESPAWN_INVULNERABILITY_DURATION_MS;
        return l != null && l < now;
    }
}
